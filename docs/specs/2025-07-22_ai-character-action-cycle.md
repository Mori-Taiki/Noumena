# 仕様書: AI Character Action Cycle

## 1. 概要 (Overview)

Azure Storage Queueからトリガーされ、単一のキャラクターの1回分の思考と行動を処理し、その結果（新しい投稿や状態変化）をNeo4jデータベースに永続化するAIエンジンの中核的なサイクルです。

## 2. ユーザーストーリー (User Stories)

-   **US-1:** 開発者として、キャラクターの状態を含むメッセージをキューに送信することで、そのキャラクターに自律的な行動（思考と投稿）を促したい。なぜなら、キャラクターが「生きている」かのように振る舞う世界を実現したいからだ。

## 3. 受け入れ基準 (Acceptance Criteria)

### US-1に対する受け入れ基準

-   **シナリオ1:** 正常な行動サイクル
    -   **Given:** Neo4jデータベースにキャラクターAが存在し、Azure Storage QueueにキャラクターAのIDを含むメッセージが送信される。
    -   **When:** AIエンジンがキューメッセージをトリガーとして起動する。
    -   **Then:**
        -   AIエンジンはキャラクターAの現在の状態（性格、感情、関係性など）をNeo4jから読み込む (Perceive)。
        -   AIエンジンは読み込んだ状態に基づき、キャラクターAの次の「思考（Thought）」と「行動内容（Action Content）」をLLMを用いて生成する (Think)。
        -   AIエンジンは生成された思考と行動内容から、新しい`Post`ノードと、キャラクターAの状態変化（感情など）を表すデータベース更新コマンドを生成する (Act)。
        -   AIエンジンは生成した`Post`ノードをNeo4jに作成し、キャラクターAに`POSTED`リレーションで接続する。
        -   AIエンジンは生成した状態更新コマンドを実行し、キャラクターAのノードプロパティを更新する。

## 4. スコープ外 (Out of Scope)

-   複数のキャラクターが同時に相互作用するロジック。
-   ユーザーからの直接的な介入（ワールドイベントなど）への応答。
-   APIキーの管理や利用制限のロジック。
